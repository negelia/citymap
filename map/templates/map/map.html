<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Toilet, Water & Relax</title>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Inter:wght@400;600&family=JetBrains+Mono&display=swap');
  </style>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Mapbox -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="{% static 'js/script.js' %}" defer></script>
</head>
<body>
  <!-- –û–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
  {% if not user.is_authenticated %}
  <div id="authModal" class="auth-container">
    <div class="auth-box">
      <h1>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
      <div class="tabs">
        <button class="tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
        <button class="tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
      <div class="form" id="loginForm">
        <input type="text" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="login()">–í–æ–π—Ç–∏</button>
      </div>
      <div class="form hidden" id="registerForm">
        <input type="text" placeholder="–ò–º—è">
        <input type="email" placeholder="Email">
        <input type="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
      <span class="forgot">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</span>
    </div>
  </div>
  {% endif %}

  <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div id="mainContainer">
    <header>
      Toilet, Water & Relax <span class="highlight">*</span>
    </header>

    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π -->
    <div class="map-controls left">
      <label for="filterSelect" class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</label>
      <select id="filterSelect" class="form-select" onchange="filterMarkersByCategory()">
        <option value="all">–í—Å–µ</option>
        <option value="toilet">–°–∞–Ω—É–∑–µ–ª</option>
        <option value="water">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–¥—ã</option>
        <option value="rest">–ó–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞</option>
      </select>
    </div>

    {% if user.is_authenticated %}
    <div class="map-controls right">
      <label for="roleSelect" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:</label>
      <select id="roleSelect" class="form-select">
        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
        <option value="moderator">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
      </select>

      <div class="mt-2">
        <a href="{% url 'logout' %}" class="btn btn-danger btn-sm">–í—ã–π—Ç–∏</a>
      </div>
    </div>
    {% endif %}

    <!-- –ö–∞—Ä—Ç–∞ -->
    <div id="map"></div>

    <!-- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é -->
    <div class="menu-buttons">
      <button class="btn btn-pink" onclick="enableAddMode()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</button>
      <button class="btn btn-success" onclick="findNearby()">üìç –¢—É–∞–ª–µ—Ç—ã —Ä—è–¥–æ–º</button>
      <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#forumModal">üí¨ –§–æ—Ä—É–º</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ Bootstrap -->
  <div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="toiletForm">
          <div class="modal-header">
            <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç—É–∞–ª–µ—Ç</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
              <input type="text" class="form-control" id="toiletTitle" required>
            </div>
            <div class="mb-3">
              <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea class="form-control" id="toiletDescription" rows="3"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">–§–æ—Ç–æ</label>
              <input type="file" class="form-control" id="toiletPhoto" accept="image/*">
            </div>
            <div class="mb-3">
              <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select class="form-select" id="toiletCategory" required>
                <option value="toilet">–°–∞–Ω—É–∑–µ–ª</option>
                <option value="water">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–¥—ã</option>
                <option value="rest">–ó–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞</option>
              </select>
            </div>
            {% if user.is_authenticated and user.is_staff %}
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="moderationCheckbox">
              <label class="form-check-label" for="moderationCheckbox">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º</label>
            </div>
            {% endif %}
            <div class="mb-3">
              <label class="form-label">–†–µ–π—Ç–∏–Ω–≥ (1-5)</label>
              <input type="number" class="form-control" id="toiletRating" min="1" max="5" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-pink">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="forumModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–§–æ—Ä—É–º —Ç—É–∞–ª–µ—Ç–æ–≤</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" class="form-control mb-2" id="usernameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
          <div class="chat-messages" id="chatMessages"></div>
          <form id="chatForm" class="d-flex mt-2">
            <input type="text" class="form-control me-2" id="chatInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" required>
            <button type="submit" class="btn btn-pink">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="rewardModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content text-center p-4">
        <h5 class="modal-title" id="rewardText">üéâ</h5>
        <button type="button" class="btn btn-success mt-3" data-bs-dismiss="modal">–ö—Ä—É—Ç–æ!</button>
      </div>
    </div>
  </div>
</body>
</html>